---
title: "Indicadores no R: indicadores de outras formas de trabalho na PNADC anual"
author: "Italo Mendonça"
date: "27-novembro-2024"
output:
   bookdown::html_document2:
    toc: true
    toc_float: true
    number_sections: true
    df_print: kable
    fig_caption: TRUE
editor_options:
  markdown:
    wrap: 72
bibliography: references.bib
csl: associacao-brasileira-de-normas-tecnicas-ufrgs.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # Esta linha de código é usada para definir opções globais para todos os trechos de código (chunks) encontrados no documento. o argumento "echo = TRUE" indica que o código contido em cada chunk deve ser exibido no documento final gerado a partir do arquivo R Markdown. Ou seja, quando o documento for renderizado (convertido para um formato final como PDF, HTML, etc.), o código R que foi escrito dentro de cada chunk aparecerá ao lado dos resultados de sua execução.
```

O objetivo deste tutorial é extrair os dados amostrais da PNADC anual de
outras formas de trabalho com auxílio do pacote PNADcIBGE [@PNADcIBGE].

# Pergunta orientadora

Qual o perfil das pessoas de 14 anos ou mais de idade, por condição em
relação à força de trabalho e condição de ocupação

# Base de dados e conferência dos dados

Os dados necessários para responder a pergunta proposta estão presentes
na quinta visita da PNADC.

```{r dados, echo=TRUE, warning=FALSE}
# carrega as bibliotecas
library(PNADcIBGE) # Carrega o pacote PNADcIBGE
library(survey) # Carrega o pacote survey
library(dplyr) # Carrega o pacote dplyr
library(knitr) # Carrega o pacote knitr

# definição de variáveis - cria um vetor com as variáveis que serão importadas da PNADc
variaveis_selecionadas <- c(
  "UF",
  "VD4002",
  "V4013",
  "VD4020",
  "VD3005",
  "V4012",
  "V2007",
  "V2010",
  "V2009",
  "VD4039",
  "VD3004",
  "VD4035"
)

# importando os dados do servidor do IBGE
dadosPNADc <- get_pnadc(year = 2022,
                        interview = 5,
                        vars = variaveis_selecionadas)


options(survey.lonely.psu = "adjust")

# Opção de vizualização de números
# A linha de código a seguir instrui o ambiente a evitar a notação científica ao
# imprimir números. Isso significa que números muito grandes ou muito pequenos
# serão exibidos na sua forma completa, sem a utilização do formato exponencial
# (como 1e+10 ou 1e-10).
options(scipen = 999)

# modifica e cria variáveis
dadosPNADc$variables <- dadosPNADc$variables %>%
  mutate(
    one = 1,
    ocupados = 1 * (
      VD4002 == "Pessoas ocupadas"
    ),
     desocupados = 1 * (
      VD4002 == "Pessoas desocupadas"
    ),
    raca_cor = case_when(
      V2010 == "Preta" | V2010 == "Parda" ~ "Preta ou parda",
      V2010 == "Amarela"  |
        V2010 == "Indígena" | V2010 == "Ignorado" ~ "Outras",
      V2010 == "Branca" ~ "Branca"
    ),
    faixa_idade = case_when((V2009 >= 14 &
                               V2009 <= 29) ~ "0De14a29anos",
                            (V2009 >= 30 &
                               V2009 <= 44) ~ "de30a44anos",
                            (V2009 >= 45 &
                               V2009 <= 59) ~ "de45a59anos",
                            (V2009 >= 60) ~ "de60a+anos"
    ),
    estratos_geogr = case_when((
      Estrato == "3110213" |
        Estrato == "3110113" |
        Estrato == "3110112" |
        Estrato == "3110212" |
        Estrato == "3110111" |
        Estrato == "3110211"
    ) ~ "01-Belo Horizonte",
    (
      Estrato == "3120011" |
        Estrato == "3120013" |
        Estrato == "3120020" |
        Estrato == "3120012"
    ) ~ "02-Entorno metropolitono de BH",
    (Estrato == "3130011" |
       Estrato == "3130012" |
       Estrato == "3130020") ~ "03-Colar metropolitano de BH",
    (Estrato == "3140010" |
       Estrato == "3140020") ~ "04-RIDE de Brasília em Minas",
    (
      Estrato == "3151011" |
        Estrato == "3151012" |
        Estrato == "3151013" |
        Estrato == "3151021" |
        Estrato == "3151022" |
        Estrato == "3151023"
    ) ~ "05-Sul de Minas",
    (
      Estrato == "3152011" |
        Estrato == "3152012" |
        Estrato == "3152013" |
        Estrato == "3152021" |
        Estrato == "3152022"
    ) ~ "06-Triângulo Mineiro",
    (
      Estrato == "3153011" |
        Estrato == "3153012" |
        Estrato == "3153013" |
        Estrato == "3153021" |
        Estrato == "3153022" |
        Estrato == "3153023"
    ) ~ "07-Mata de Minas Gerais",
    (
      Estrato == "3154011" |
        Estrato == "3154012" |
        Estrato == "3154013" |
        Estrato == "3154021" |
        Estrato == "3154022" |
        Estrato == "3154023"
    ) ~ "08-Norte de Minas",
    (
      Estrato == "3155011" |
        Estrato == "3155012" |
        Estrato == "3155013" |
        Estrato == "3155021" |
        Estrato == "3155022" |
        Estrato == "3155023"
    ) ~ "09-Vale do Rio Doce",
    (
      Estrato == "3156011" |
        Estrato == "3156012" |
        Estrato == "3156013" |
        Estrato == "3156021" |
        Estrato == "3156022"
    ) ~ "10-Central"
    )
  )

```

# Pessoas ocupadas

## Total e proporção de pessoas ocupadas

Determinando o total de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados1a, echo=TRUE, warning=FALSE}

# Determinação do valor estimado
Valor_Estimativa <- round(coef(svytotal(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )), 0)
# Determinação do erro padrão
Valor_Erro_padrao <- round(SE(svytotal(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )), 0)
# Determinação do coeficiente de variação
Valor_Coeficiente_variacao <- round(cv(svytotal(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1)
# Determinação do Limite inferior do intervalo de confiança do valor estimado com 95% de confiança (limite 2,5% da distribuição normal)
Valor_Limite_inferior <- round(confint(svytotal(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[1], 0)
# Determinação do Limite superior do intervalo de confiança do valor estimado com 95% de confiança (limite 97,5% da distribuição normal)
Valor_Limite_superior <- round(confint(svytotal(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[2], 0)

# Cria um dataframe com os valores determinados anteriormente
tab.1a <- data.frame(
  Estimativa  = Valor_Estimativa,
  Erro_padrao = Valor_Erro_padrao,
  CV = Valor_Coeficiente_variacao,
  Limite_inferior = Valor_Limite_inferior,
  Limite_superior = Valor_Limite_superior
)

```

```{r printtab1a}
knitr::kable(tab.1a,
             caption = "Total de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022",
             digits = 2)

```

Proporção de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados1b, echo=TRUE, warning=FALSE}
tab.1b <- data.frame(
  Estimativa  = round(coef(svymean(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  Erro_padrao = round(SE(svymean(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  CV = round(cv(svymean(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  Limite_inferior = round(confint(svymean(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[1] * 100, 1),
  Limite_superior = round(confint(svymean(
    ~ ocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[2] * 100, 1)
)

```

```{r printtab1b}
knitr::kable(tab.1b,
             caption = "Proporção de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022")
```

## Desagregação por estratos geográficos

Total de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados5a, echo=TRUE, warning=FALSE}

tab.5a <- data.frame(
  Estimativa  = round(coef(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ), 0),
  Erro_padrao = round(SE(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ), 0),
  CV = round(cv(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ) * 100, 1),
  Limite_inferior = round(confint(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  )[, 1], 0),
  Limite_superior = round(confint(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  )[, 2], 0)
)

```

```{r printtab5a}
knitr::kable(tab.5a,
             caption = "Total de ocupados segundo estratos geográficos - Minas Gerais - 2022")

```

Proporção de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados5b, echo=TRUE, warning=FALSE}
tab.5b <- data.frame(
  Estimativa  = round(coef(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  Erro_padrao = round(SE(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  CV = round(cv(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  Limite_inferior = round(confint(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  )[, 1] * 100, 1),
  Limite_superior = round(confint(
    svyby(
      ~ ocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  )[, 2] * 100, 1)
)

```

```{r printtab5b}
knitr::kable(tab.5b,
             caption = "Total de pessoas de 14 anos ou mais de idade, ocupadas, por estrato geográfico em Minas Gerais para o ano de 2022")


```

# Pessoas desocupadas

## Total e proporção de pessoas desocupadas

Determinando o total de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados1c, echo=TRUE, warning=FALSE}

# Determinação do valor estimado
Valor_Estimativa <- round(coef(svytotal(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )), 0)
# Determinação do erro padrão
Valor_Erro_padrao <- round(SE(svytotal(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )), 0)
# Determinação do coeficiente de variação
Valor_Coeficiente_variacao <- round(cv(svytotal(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1)
# Determinação do Limite inferior do intervalo de confiança do valor estimado com 95% de confiança (limite 2,5% da distribuição normal)
Valor_Limite_inferior <- round(confint(svytotal(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[1], 0)
# Determinação do Limite superior do intervalo de confiança do valor estimado com 95% de confiança (limite 97,5% da distribuição normal)
Valor_Limite_superior <- round(confint(svytotal(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[2], 0)

# Cria um dataframe com os valores determinados anteriormente
tab.1c <- data.frame(
  Estimativa  = Valor_Estimativa,
  Erro_padrao = Valor_Erro_padrao,
  CV = Valor_Coeficiente_variacao,
  Limite_inferior = Valor_Limite_inferior,
  Limite_superior = Valor_Limite_superior
)

```

```{r printtab1c}
knitr::kable(tab.1c,
             caption = "Total de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022",
             digits = 2)

```

Proporção de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados1d, echo=TRUE, warning=FALSE}
tab.1d <- data.frame(
  Estimativa  = round(coef(svymean(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  Erro_padrao = round(SE(svymean(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  CV = round(cv(svymean(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  )) * 100, 1),
  Limite_inferior = round(confint(svymean(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[1] * 100, 1),
  Limite_superior = round(confint(svymean(
    ~ desocupados, subset(dadosPNADc, UF == "Minas Gerais"), na.rm = TRUE
  ))[2] * 100, 1)
)

```

```{r printtab1d}
knitr::kable(tab.1d,
             caption = "Proporção de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022")
```

## Desagregação por estratos geográficos

Total de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados5c, echo=TRUE, warning=FALSE}

tab.5c <- data.frame(
  Estimativa  = round(coef(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ), 0),
  Erro_padrao = round(SE(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ), 0),
  CV = round(cv(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  ) * 100, 1),
  Limite_inferior = round(confint(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  )[, 1], 0),
  Limite_superior = round(confint(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svytotal,
      na.rm = TRUE
    )
  )[, 2], 0)
)

```

```{r printtabc}
knitr::kable(tab.5c,
             caption = "Total de pessoas desocupadas segundo estratos geográficos - Minas Gerais - 2022")

```

Proporção de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022

```{r dados5d, echo=TRUE, warning=FALSE}
tab.5d <- data.frame(
  Estimativa  = round(coef(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  Erro_padrao = round(SE(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  CV = round(cv(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  ) * 100, 1),
  Limite_inferior = round(confint(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  )[, 1] * 100, 1),
  Limite_superior = round(confint(
    svyby(
      ~ desocupados,
      by = ~ estratos_geogr,
      subset(dadosPNADc, UF == "Minas Gerais"),
      svymean,
      na.rm = TRUE
    )
  )[, 2] * 100, 1)
)

```

```{r printtab5d}
knitr::kable(tab.5d,
             caption = "Proporção de pessoas de 14 anos ou mais de idade, desocupadas, por estrato geográfico em Minas Gerais para o ano de 2022")


```
