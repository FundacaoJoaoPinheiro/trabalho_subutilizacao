---
title: "Indicadores no R: indicadores de outras formas de trabalho na PNADC anual"
author: "Italo Mendonça"
date: "27-novembro-2024"
output:
   bookdown::html_document2:
    toc: true
    toc_float: true
    number_sections: true
    df_print: kable
    fig_caption: TRUE
editor_options:
  markdown:
    wrap: 72
bibliography: references.bib
csl: associacao-brasileira-de-normas-tecnicas-ufrgs.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # Esta linha de código é usada para definir opções globais para todos os trechos de código (chunks) encontrados no documento. o argumento "echo = TRUE" indica que o código contido em cada chunk deve ser exibido no documento final gerado a partir do arquivo R Markdown. Ou seja, quando o documento for renderizado (convertido para um formato final como PDF, HTML, etc.), o código R que foi escrito dentro de cada chunk aparecerá ao lado dos resultados de sua execução.
```

O objetivo deste tutorial é extrair os dados amostrais da PNADC anual de
outras formas de trabalho com auxílio do pacote PNADcIBGE [@PNADcIBGE].

# Pergunta orientadora

Qual a Taxa combinada da desocupação e subocupação por insuficiência de horas 
trabalhadas

Numerador - Subocupados por insuficiência de horas + desocupados 
Denominador - Força de Trabalho


# Base de dados e conferência dos dados

Os dados necessários para responder a pergunta proposta estão presentes
na quinta visita da PNADC.

```{r dados, echo=TRUE, warning=FALSE}
# carrega as bibliotecas
library(PNADcIBGE) # Carrega o pacote PNADcIBGE
library(survey) # Carrega o pacote survey
library(dplyr) # Carrega o pacote dplyr
library(knitr) # Carrega o pacote knitr

# definição de variáveis - cria um vetor com as variáveis que serão importadas da PNADc
variaveis_selecionadas <- c(
  "UF",
  "VD4001",
  "VD4002",
  "VD4004A",
  "V4013",
  "VD4020",
  "VD3005",
  "V4012",
  "V2007",
  "V2010",
  "V2009",
  "VD4039",
  "VD3004",
  "VD4003",
  "VD4035"
)

# importando os dados do servidor do IBGE
dadosPNADc <- get_pnadc(year = 2022,
                        interview = 5,
                        vars = variaveis_selecionadas)


options(survey.lonely.psu = "adjust")

# Opção de vizualização de números
# A linha de código a seguir instrui o ambiente a evitar a notação científica ao
# imprimir números. Isso significa que números muito grandes ou muito pequenos
# serão exibidos na sua forma completa, sem a utilização do formato exponencial
# (como 1e+10 ou 1e-10).
options(scipen = 999)

# modifica e cria variáveis
dadosPNADc$variables <- dadosPNADc$variables %>%
  mutate(
    one = 1,
    ocupados = 1 * (
      VD4002 == "Pessoas ocupadas"
    ),
     desocupados = 1 * (
      VD4002 == "Pessoas desocupadas"
    ),
    subocupados = 1 * (
      VD4004A == "Pessoas subocupadas"
    ),
    combinada1 = coalesce(subocupados, desocupados
    ),
   ftp = 1 * (
      VD4003 == "Pessoas fora da força de trabalho e na força de trabalho potencial"
    ),
    ft = 1 * (
      VD4001 == "Pessoas na força de trabalho"
    ),
    fta = ftp + ft,
    raca_cor = case_when(
      V2010 == "Preta" | V2010 == "Parda" ~ "Preta ou parda",
      V2010 == "Amarela"  |
        V2010 == "Indígena" | V2010 == "Ignorado" ~ "Outras",
      V2010 == "Branca" ~ "Branca"
    ),
    faixa_idade = case_when((V2009 >= 14 &
                               V2009 <= 29) ~ "0De14a29anos",
                            (V2009 >= 30 &
                               V2009 <= 44) ~ "de30a44anos",
                            (V2009 >= 45 &
                               V2009 <= 59) ~ "de45a59anos",
                            (V2009 >= 60) ~ "de60a+anos"
    ),
    estratos_geogr = case_when((
      Estrato == "3110213" |
        Estrato == "3110113" |
        Estrato == "3110112" |
        Estrato == "3110212" |
        Estrato == "3110111" |
        Estrato == "3110211"
    ) ~ "01-Belo Horizonte",
    (
      Estrato == "3120011" |
        Estrato == "3120013" |
        Estrato == "3120020" |
        Estrato == "3120012"
    ) ~ "02-Entorno metropolitono de BH",
    (Estrato == "3130011" |
       Estrato == "3130012" |
       Estrato == "3130020") ~ "03-Colar metropolitano de BH",
    (Estrato == "3140010" |
       Estrato == "3140020") ~ "04-RIDE de Brasília em Minas",
    (
      Estrato == "3151011" |
        Estrato == "3151012" |
        Estrato == "3151013" |
        Estrato == "3151021" |
        Estrato == "3151022" |
        Estrato == "3151023"
    ) ~ "05-Sul de Minas",
    (
      Estrato == "3152011" |
        Estrato == "3152012" |
        Estrato == "3152013" |
        Estrato == "3152021" |
        Estrato == "3152022"
    ) ~ "06-Triângulo Mineiro",
    (
      Estrato == "3153011" |
        Estrato == "3153012" |
        Estrato == "3153013" |
        Estrato == "3153021" |
        Estrato == "3153022" |
        Estrato == "3153023"
    ) ~ "07-Mata de Minas Gerais",
    (
      Estrato == "3154011" |
        Estrato == "3154012" |
        Estrato == "3154013" |
        Estrato == "3154021" |
        Estrato == "3154022" |
        Estrato == "3154023"
    ) ~ "08-Norte de Minas",
    (
      Estrato == "3155011" |
        Estrato == "3155012" |
        Estrato == "3155013" |
        Estrato == "3155021" |
        Estrato == "3155022" |
        Estrato == "3155023"
    ) ~ "09-Vale do Rio Doce",
    (
      Estrato == "3156011" |
        Estrato == "3156012" |
        Estrato == "3156013" |
        Estrato == "3156021" |
        Estrato == "3156022"
    ) ~ "10-Central"
    ),
  )


```


# Taxa de Participação na Força de Trabalho
É a razão entre a População na Força de Trabalho / População em Idade de Trabalhar

```{r dados, echo=TRUE, warning=FALSE}
tpft <- svyby(formula=~(VD4001=="Pessoas na força de trabalho"), denominator=~(V2009>=14), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(tpft,
             caption = "Taxa de Participação na Força de Trabalho para os estratos geográficos - Minas Gerais - 2022")
```

#Nível de Ocupação 
É a razão entre a População Ocupada/ População em Idade de Trabalhar
```{r dados, echo=TRUE, warning=FALSE}
nivel_ocup <- svyby(formula=~(VD4002=="Pessoas ocupadas"), denominator=~(V2009>=14), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(nivel_ocup,
             caption = "Nível de ocupação para os estratos geográficos - Minas Gerais - 2022")
```

#Taxa de ocupação
Razão entre a População Ocupada / População na força de trabalho

```{r dados, echo=TRUE, warning=FALSE}
tx_ocup <- svyby(formula=~(VD4002=="Pessoas ocupadas"), denominator=~(VD4001=="Pessoas na força de trabalho"), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(tx_ocup,
             caption = "Taxa de ocupação, para os estratos geográficos - Minas Gerais - 2022")
```

#Nível de desocupação
Razão entre a população desocupada / População em idade de trabalhar

```{r dados, echo=TRUE, warning=FALSE}
nivel_desocup <- svyby(formula=~(VD4002=="Pessoas desocupadas"), denominator=~(V2009>=14), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(nivel_desocup,
             caption = "Nível de desocupação, para os estratos geográficos - Minas Gerais - 2022")
```

#Taxa de desocupação 
Razão entre a população desocupada / População na Força de Trabalho
```{r dados, echo=TRUE, warning=FALSE}
tx_desocup <- svyby(formula=~(VD4002=="Pessoas desocupadas"), denominator=~(VD4001=="Pessoas na força de trabalho"), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(tx_desocup,
             caption = "Taxa de desocupação, para os estratos geográficos - Minas Gerais - 2022")
```

Taxa combinada da subocupação por insuficiência de horas trabalhadas e da desocupação (TCSIeD)
TCSIeD = (Subocupados por Insuficiência de Horas + Desocupados) / Força de Trabalho

```{r dados, echo=TRUE, warning=FALSE}

tcsied <-  svyratio(numerator=~(combinada1==1), denominator=~(VD4001=="Pessoas na força de trabalho"),  design=dadosPNADc, na.rm=TRUE)

knitr::kable(tcsied,
             caption = "Taxa combinada da subocupação por insuficiência de horas trabalhadas e da desocupação (TCSIeD), para os estratos geográficos - Minas Gerais - 2022")
```

Taxa Combinada da Desocupação e da Força de Trabalho Potencial (TCDeFTP)
TCDeFTP = (Desocupados + Força de Trabalho Potencial) / Força de Trabalho Ampliada
```{r dados, echo=TRUE, warning=FALSE}

tcdeftp <-  svyby(formula=~(desocupados+ftp), denominator=~(fta), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(tcdeftp,
             caption = "Taxa Combinada da Desocupação e da Força de Trabalho Potencial (TCDeFTP), para os estratos geográficos - Minas Gerais - 2022")
```

Taxa Composta da subutilização da Força de Trabalho (TCSFT)
TCSFT = (Subocupados por Insuficiência de Horas + Desocupados + Força de Trabalho Potencial) / Força de Trabalho Ampliada
```{r dados, echo=TRUE, warning=FALSE}

tcsft <-  svyby(formula=~(subocupados+desocupados+ftp), denominator=~(fta), by=~interaction(estratos_geogr), design=dadosPNADc, FUN=svyratio, vartype="cv", na.rm=TRUE)

knitr::kable(tcsft,
             caption = "Taxa Combinada da Desocupação e da Força de Trabalho Potencial (TCDeFTP), para os estratos geográficos - Minas Gerais - 2022")
```
